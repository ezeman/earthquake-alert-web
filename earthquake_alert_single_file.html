<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบแจ้งเตือนแผ่นดินไหว</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

    header {
        background-color: #333;
        color: #fff;
        text-align: center;
        padding: 1rem 0;
    }

    main {
        display: flex;
        flex-direction: row;
        height: calc(100vh - 80px);
    }

    #map {
        flex: 3;
        height: 100%;
    }

    #info {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        background-color: #f4f4f4;
    }

    #quake-list {
        list-style-type: none;
        padding: 0;
    }

    #quake-list li {
        margin-bottom: 1rem;
        padding: 0.5rem;
        background-color: #fff;
        border-left: 5px solid #ff0000;
    }

    @media screen and (max-width: 768px) {
        main {
            flex-direction: column;
        }

        #map {
            height: 50vh;
        }

        #info {
            height: 50vh;
        }
    }
    </style>
</head>
<body>
    <header>
        <h1>ระบบแจ้งเตือนแผ่นดินไหว </h1>
    </header>
    <main>
        <div id="map"></div>
        <div id="info">
            <h2>แผ่นดินไหวล่าสุด (ย้อนหลัง 7 วัน)</h2>
            <ul id="quake-list"></ul>
        </div>
    </main>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const end = new Date(); // วันนี้
        const start = new Date();
        start.setDate(end.getDate() - 7); // ย้อนหลัง 7 วัน

        const startStr = start.toISOString().split('T')[0];
        const endStr = end.toISOString().split('T')[0];

        const url = `https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime=${startStr}&endtime=${endStr}&minmagnitude=2.5&maxradiuskm=1000&latitude=18.7061&longitude=98.9817`;

        var map = L.map('map').setView([15.8700, 100.9925], 6);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        function getColor(magnitude) {
            return magnitude > 6 ? '#ff0000' :
                   magnitude > 4 ? '#ff6600' :
                   magnitude > 2 ? '#ffcc00' :
                                   '#00ff00';
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                var earthquakes = data.features;
                var quakeList = document.getElementById('quake-list');

                earthquakes.forEach(function (quake) {
                    var coords = quake.geometry.coordinates;
                    var magnitude = quake.properties.mag;
                    var place = quake.properties.place;
                    var time = new Date(quake.properties.time);

                    L.circleMarker([coords[1], coords[0]], {
                        radius: magnitude * 2,
                        fillColor: getColor(magnitude),
                        color: '#000',
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map)
                      .bindPopup(`<strong>สถานที่:</strong> ${place}<br><strong>ขนาด:</strong> ${magnitude}<br><strong>เวลา:</strong> ${time.toLocaleString()}`);

                    var listItem = document.createElement('li');
                    listItem.innerHTML = `<strong>สถานที่:</strong> ${place}<br><strong>ขนาด:</strong> ${magnitude}<br><strong>เวลา:</strong> ${time.toLocaleString()}`;
                    quakeList.appendChild(listItem);
                });
            })
            .catch(error => console.error('เกิดข้อผิดพลาดในการดึงข้อมูล:', error));
    });
    </script>
</body>
</html>
